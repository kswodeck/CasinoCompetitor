<%- include('partials/header') %>

<div id="mid-container">
</div>
<% if (success && emailSent){ %>
<script>
  window.onload = function() {
    sendForgotPWEmail('<%= emailSent %>', '<%= userId %>');
    displayForgotDialog('forgotPWDialog', '<%= success %>'); // displayDialog('changePWDialog');
    var uri = window.location.toString();
    if (uri.indexOf("?") > 0) {
      var clean_uri = uri.substring(0, uri.indexOf("?"));
      window.history.replaceState({}, document.title, clean_uri);
    }
  };
</script>
<% } else if (!currentUser) { %>
  <script>
    window.onload = function() {
      displayForgotDialog('forgotPWDialog', '<%= error %>');
    };
  </script>
<% } else { %>
  <script>
    window.onload = function() {
      displayForgotDialog('forgotPWDialog', false);
    };
  </script>
<% } %>

<% if (!currentUser && updatePW){ %>
  <script>
      window.onload = function() {
      displayDialog('changePWDialog');
    };
  </script>
  <% } %>

<dialog id="changePWDialog" class="container-fluid account-form-div account-dialog">
  <div class ="exit-button-div">
    <button id="changePWDialogExit" class="exit-dialog-button md-text" onclick="window.location.href = '/login'">âœ–</button>
  </div>
  <h2 id="changePWHeading" class="login-heading blue-text">Update Password</h2>
  <form action="/forgotpass/<%= userId %>/?_method=PUT" method="POST">
    <label for="password" class="account-label sm-txt">New Password</label><br>
    <input type="password" name="password" id="changePassword" class="changePassInput password user-input" minlength="5" maxlength="20" placeholder="password" size="25" autocomplete="new-password" required><i id="changePassIcon" onclick="togglePasswordVisibility('changePassword', 'changePassIcon')" class="show-hide input-icon fas fa-eye"></i><br>
    <label for="repeatChangePassword" class="account-label sm-txt">Repeat Password</label><br>
    <input type="password" name="repeatChangePassword" id="repeatChangePassword" class="changePassInput password user-input" minlength="5" maxlength="20" placeholder="password" size="25" autocomplete="new-password" required><i id="repeatChangePassIcon" onclick="togglePasswordVisibility('repeatChangePassword', 'repeatChangePassIcon')" class="show-hide input-icon fas fa-eye"></i><br>
    <ul id="invalid-change-password" class="invalid-fields-list"></ul>
    <input type="submit" name="password-change" onclick="return validatePasswordChange()" role="button" value="Create New Password" class="btn md-text blue-bg gold-text btn-style" id="passwordChangeButton">
  </form>
</dialog>

<%- include('partials/logindialogs') %>
<%- include('partials/footer') %>
<%- include('partials/javascripts') %>