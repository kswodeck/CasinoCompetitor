<%- include('partials/header') %>

<div id="mid-container">
    <h1 id="leaderboard-heading"><span id="leaderboard-span" class="italicized-subheading">Competitive</span><br />Leaderboard</h1>
    <div id="leaderboard-div" class="container-fluid">
      <table id ="leaderboard-table" class="xs-text">
        <thead>
          <tr id="table-search-row">
            <th id="table-search-cell" class="leaderboard-cell" colspan="4" scope="colgroup">
              <form action="/leaderboard" method="GET" action="#" onsubmit="searchLeaderboard('<%= curPage %>'); return false;" id="leaderboardSearchForm">
                <button id="search-button" class="btn sm-text" name="search" type="submit" onclick="restoreLeaderboard('<%= curPage %>')"><i id="table-search-icon" class="fas fa-search"></i></button>
                <input type="search" id="tableSearch" class="table-search" name="search" size="22" maxlength="20" placeholder="search by username..." incremental>
              </form>
            </th>
          </tr>
        </thead>
        <tbody id ="leaderboard-body">
          <tr id="leaderboard-head-row">
            <td class="leaderboard-head">Rank</td>
            <td class="leaderboard-head">Username</td>
            <td class="leaderboard-head">Highest Win</td>
            <td class="leaderboard-head">Total Coins</td>
          </tr>
          <!-- must delete all kswodecks, duplicates and such after going live (empty whole db) -->
          <% for (let i = 0; i < pageUsers.length; i++) { %>
            <tr class ="leaderboard-row normal-row">
              <td class ="leaderboard-cell leaderboard-rank"><%= ranks[i] %></td>
              <td class ="leaderboard-cell leaderboard-username"><%= pageUsers[i].username %></td>
              <td class ="leaderboard-cell leaderboard-highest"><%= pageUsers[i].highestWin %></td>
              <td class ="leaderboard-cell leaderboard-coins"><%= pageUsers[i].coins %></td>
            </tr>
        <% } %>
        </tbody>
      </table>
      <% let numPages = Math.ceil(users.length / 100) %>
      <% let startPage = curPage - 4 %>
      <% let endPage = curPage + 4 %>
      <% if (curPage < 5) { %>
        <% startPage = 1 %>
        <% endPage = 9 %>
      <% } else if (numPages - 4 < curPage) { %>
        <% endPage = numPages %>
        <% startPage = numPages - 8 %>
      <% } %>
        <% if (numPages > 1) { %>
        <nav id="leaderboard-pagination" aria-label="Page navigation">
          <ul id="pagination-list" class="pagination sm-text">
            <li class="page-item">
              <a class="page-link blue-text" onclick="changePage(1, '<%= search %>')" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <% let page = startPage %>
            <% for (let i = 1; i < 10 && i < numPages+1; i++) { %>
              <li class="page-item"><a class="page-link blue-text" onclick="changePage('<%= page %>', '<%= search %>')"><%= page %></a></li>
            <% page++; %>
            <% } %>
            <li class="page-item">
              <a class="page-link blue-text" onclick="changePage('<%= numPages %>', '<%= search %>')" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
        <% } %>
    </div>
</div>

<%- include('partials/logindialogs') %>
<%- include('partials/footer') %>
<script src="\javascripts\leaderboard.js" type="text/javascript" ></script>
<%- include('partials/javascripts') %>